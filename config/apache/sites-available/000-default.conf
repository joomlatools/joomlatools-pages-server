# Default vhost
# http://localhost:8080
<VirtualHost *:8080>

    use vhost
    use site

    <LocationMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
         RequestHeader set  X-Site-Name "expr=%{env:MATCH_SITENAME}"
         RequestHeader set  X-Site-Base "expr=\/%{env:MATCH_SITENAME}"
    </LocationMatch>

</VirtualHost>

# https://localhost:8443
<VirtualHost *:8443>

    use ssl default

    use vhost
    use site

    <LocationMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
        RequestHeader set  X-Site-Name "expr=%{env:MATCH_SITENAME}"
        RequestHeader set  X-Site-Base "expr=\/%{env:MATCH_SITENAME}"
    </LocationMatch>

</VirtualHost>

# .test vhost proxied by Traefik
#---------------------------------------------

# http://[site].test
# http://www.[site].test
<VirtualHost *:80>

    VirtualDocumentRoot "${APP_ROOT}/sites/%-2"

    use vhost
    use site

    <LocationMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
        RequestHeader set  X-Site-Name "expr=%{env:MATCH_SITENAME}"
        RequestHeader set  X-Site-Base "/"
    </LocationMatch>

</VirtualHost>

# https://[site].test
# https://www.[site].test
<VirtualHost *:443>

    VirtualDocumentRoot "${APP_ROOT}/sites/%-2"

    use ssl default

    use vhost
    use site

    <LocationMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
        RequestHeader set  X-Site-Name "expr=%{env:MATCH_SITENAME}"
        RequestHeader set  X-Site-Base "/"
    </LocationMatch>

</VirtualHost>