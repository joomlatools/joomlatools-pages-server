# Default vhost
# http://localhost:8080
<VirtualHost *:${APP_HTTP}>

    use vhost
    use site

    <DirectoryMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
         RequestHeader set  X-App-Base "expr=\/%{env:MATCH_SITENAME}"
    </DirectoryMatch>

</VirtualHost>

# https://localhost:8443
<VirtualHost *:${APP_HTTPS}>

    use ssl default

    use vhost
    use site

    <DirectoryMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
        RequestHeader set  X-App-Base "expr=\/%{env:MATCH_SITENAME}"
    </DirectoryMatch>

</VirtualHost>

# .test vhost proxied by Traefik
#---------------------------------------------

# http://[site].test
# http://www.[site].test
<VirtualHost *:80>

    VirtualDocumentRoot "/var/www/sites/%-2"

    use vhost
    use site

    RequestHeader set  X-App-Base "/"

</VirtualHost>

# https://[site].test
# https://www.[site].test
<VirtualHost *:443>

    VirtualDocumentRoot "/var/www/sites/%-2"

    use ssl default

    use vhost
    use site

    RequestHeader set  X-App-Base "/"

</VirtualHost>

# .trycloudflare.com vhost proxied by CloudFlared
#------------------------------------------------

# https://*.trycloudflare.com
<VirtualHost *:80>

    ServerName trycloudflare.com
    ServerAlias *.trycloudflare.com

    use vhost
    use site

    <DirectoryMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
        RequestHeader set  X-App-Base "expr=%{env:MATCH_SITENAME}"
    </DirectoryMatch>

</VirtualHost>

# https://*.trycloudflare.com
<VirtualHost *:443>

    ServerName trycloudflare.com
    ServerAlias *.trycloudflare.com

    use ssl default

    use vhost
    use site

    <DirectoryMatch "^${APP_ROOT}/sites/(?<sitename>[^/]+)">
        RequestHeader set  X-App-Base "expr=%{env:MATCH_SITENAME}"
    </DirectoryMatch>

</VirtualHost>